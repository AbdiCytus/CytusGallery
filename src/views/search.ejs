<%- include('partials/header') %>

<main class="container mx-auto p-4">
  <h2 class="text-2xl font-semibold text-center mb-8">
    Hasil Pencarian untuk: <span class="text-cyan-400"><%= tags %></span>
  </h2>

  <div class="columns-2 md:columns-5 gap-4 space-y-4">
    <% posts.forEach((post, index) => { %>
    <% if (post.large_file_url) { %>
    <div class="group gallery-item relative break-inside-avoid bg-gray-800 rounded-md overflow-hidden" data-post-url="/posts/<%= post.id %>">
      <div class="absolute top-1 left-1 z-20 bg-black/50 text-white text-xs px-1.5 py-0.5 rounded-full">
        <%= index + 1 %>
      </div>

      <% if (post.large_file_url.endsWith('.mp4') || post.large_file_url.endsWith('.webm')) { %>
      <video class="w-full h-auto transition-transform duration-300 group-hover:scale-105" autoplay loop muted playsinline>
        <source src="<%= post.large_file_url %>" type="video/<%= post.large_file_url.split('.').pop() %>">
      </video>
      <% } else { %>
      <img src="<%= post.large_file_url %>" alt="Konten oleh: <%= post.tag_string_artist %>" class="w-full h-auto transition-transform duration-300 group-hover:scale-105" loading="lazy">
      <% } %>

      <div class="overlay absolute inset-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent p-3 flex flex-col justify-end text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">
        <div class="overlay-content">
          <h4 class="font-bold truncate"><%= post.tag_string_character.replace(/_/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') || 'Unknown' %></h4>
          <p class="text-sm truncate"><%= post.tag_string_copyright.replace(/_/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') || 'Original' %></p>
          <a href="/posts/<%= post.id %>" class="detail-button mt-2 text-center w-full block bg-cyan-600 text-xs py-1 rounded-md hover:bg-cyan-700">
            Lihat Detail
          </a>
        </div>
      </div>
    </div>
    <% } %>
    <% }); %>
  </div>
</main>

<%- include('partials/pagination', { currentPage, totalPages, limit, tags }) %>
<%- include('partials/footer') %>