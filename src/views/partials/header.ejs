<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CytusGallery</title>
  <link href="/css/style.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
</head>

<body class="bg-gray-900 text-white min-h-screen overflow-x-hidden flex flex-col">
  <div id="loading-overlay" class="fixed inset-0 bg-gray-900/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="w-16 h-16 border-4 border-t-cyan-500 border-gray-600 rounded-full animate-spin"></div>
    <p class="text-lg text-white mt-4 animate-pulse">Loading Contents...</p>
  </div>
  <div id="custom-alert" class="fixed flex inset-0 z-50 items-center justify-center p-4 transition-opacity duration-300 ease-in-out hidden opacity-0">
    <div id="custom-alert-overlay" class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>

    <div id="custom-alert-box" class="relative bg-gray-800 border border-gray-700 rounded-lg shadow-xl w-11/12 max-w-md transition-all duration-300 ease-in-out transform">
      <button id="custom-alert-close" class="absolute top-3 right-3 text-gray-400 hover:text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <div class="p-6 flex items-start gap-4">
        <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-red-900/50">
          <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
          </svg>
        </div>
        <div class="flex-grow">
          <h3 id="custom-alert-title" class="text-xl font-bold text-white">Peringatan</h3>
          <p id="custom-alert-message" class="text-sm text-gray-300 mt-2">Isi pesan akan muncul di sini.</p>
        </div>
      </div>

      <div class="bg-gray-700/50 px-6 py-3 flex justify-end gap-3 rounded-b-lg">
        <button id="custom-alert-cancel" class="px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500">
          Batal
        </button>
        <button id="custom-alert-confirm" class="px-4 py-2 bg-cyan-600 text-white text-sm font-medium rounded-md hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-cyan-500">
          Aktifkan
        </button>
      </div>
    </div>
  </div>
  <script>
    (function() {
      // Jalankan hanya di halaman utama
      if (window.location.pathname !== '/') return;

      // Fungsi untuk membangun URL dari filter
      const buildUrlFromFilters = (filters) => {
        const params = new URLSearchParams();
        let filterQueryParts = [];

        if (filters.ratingToggle && filters.rating && filters.rating !== "all") {
          let ratingTag = filters.rating === "not_g" ? "-rating:g" : (filters.rating === "not_e" ? "-rating:e" : `rating:${filters.rating}`);
          filterQueryParts.push(ratingTag);
        }
        if (filters.typeToggle && filters.type) {
          let typeTag = '';
          if (filters.type === 'image') typeTag = 'filetype:jpg,jpeg,png,webp,gif,avif';
          else if (filters.type === 'video') typeTag = 'filetype:mp4,webm';
          if (typeTag) filterQueryParts.push(typeTag);
        }

        const filterQuery = filterQueryParts.join(' ');
        if (filterQuery) {
          params.append('query', filterQuery);
        }

        params.append('limit', filters.limit || 25);
        if (filters.lazyloadToggle) {
          params.append('lazyload', 'true');
        }

        const queryString = params.toString();
        return `/search?${queryString}`;
      };

      let filters = JSON.parse(localStorage.getItem("cytusGalleryFilters"));

      // Jika pengguna baru (tidak ada setting), buat defaultnya
      if (!filters) {
        filters = {
          ratingToggle: true,
          rating: "g",
          typeToggle: false,
          type: "image",
          limit: "25",
          autoplayToggle: false,
          lazyloadToggle: true,
        };
        localStorage.setItem("cytusGalleryFilters", JSON.stringify(filters));
      }

      // Cek jika perlu redirect (pengguna baru atau ada filter aktif)
      const needsRedirect = !localStorage.getItem("cytusGalleryFilters") || filters.ratingToggle || filters.typeToggle;

      if (needsRedirect) {
        const newUrl = buildUrlFromFilters(filters);
        // Ganti halaman saat ini, ini lebih cepat dari redirect biasa
        window.location.replace(newUrl);
      }
    })();
  </script>


  <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-30 opacity-0 pointer-events-none transition-opacity duration-300"></div>

  <aside id="sidebar" class="fixed top-0 right-0 h-full w-72 bg-gray-800 shadow-lg z-40 transform translate-x-full transition-transform duration-300 overflow-y-auto">

    <div class="p-4 relative">

      <button id="close-sidebar-button" class="absolute top-4 right-4 text-gray-400 hover:text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <div class="md:hidden pb-4 mb-4 border-b border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4">Menu</h2>
        <nav class="flex flex-col space-y-1 text-gray-300">
          <a id="home-link-mobile" href="/search" class="px-3 py-2 rounded-md hover:bg-gray-700 hover:text-white transition-colors">Home</a>
          <a href="/tentang" class="px-3 py-2 rounded-md hover:bg-gray-700 hover:text-white transition-colors">Tentang</a>
          <a href="/bantuan" class="px-3 py-2 rounded-md hover:bg-gray-700 hover:text-white transition-colors">Bantuan</a>
        </nav>
      </div>

      <h2 class="text-xl font-bold text-white mb-6">Pengaturan</h2>

      <form action="/search" method="GET" id="filter-form">
        <div class="space-y-6 text-gray-300">
          <div>
            <div class="flex justify-between items-center">
              <h3 class="font-semibold text-white">Filter Rating</h3>
              <label for="rating-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="rating-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
              </label>
            </div>
            <div id="rating-options" class="hidden mt-3 space-y-2">
              <input type="radio" name="rating" value="g" id="rating-g" class="hidden peer/safe">
              <label for="rating-g" class="w-full block text-start px-3 py-2 border-2 border-transparent rounded-md text-sm cursor-pointer hover:bg-gray-700 peer-checked/safe:border-green-500 peer-checked/safe:bg-green-900/50">Safe</label>
              <input type="radio" name="rating" value="not_e" id="rating-not_e" class="hidden peer/moderate">
              <label for="rating-not_e" class="w-full block text-start px-3 py-2 border-2 border-transparent rounded-md text-sm cursor-pointer hover:bg-gray-700 peer-checked/moderate:border-yellow-500 peer-checked/moderate:bg-yellow-900/50">Moderate</label>
              <input type="radio" name="rating" value="not_g" id="rating-not_g" class="hidden peer/explicit">
              <label for="rating-not_g" class="w-full block text-start px-3 py-2 border-2 border-transparent rounded-md text-sm cursor-pointer hover:bg-gray-700 peer-checked/explicit:border-red-500 peer-checked/explicit:bg-red-900/50">Explicit</label>
            </div>
          </div>

          <div class="pt-6 border-t border-gray-700">
            <div class="flex justify-between items-center">
              <h3 class="font-semibold text-white">Filter Tipe</h3>
              <label for="type-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="type-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
              </label>
            </div>
            <div id="type-options" class="hidden mt-3 space-y-2 text-sm">
              <input type="radio" name="type" value="image" id="type-image" class="hidden peer/image">
              <label for="type-image" class="w-full block text-start px-3 py-2 border-2 border-transparent rounded-md text-sm cursor-pointer hover:bg-gray-700 peer-checked/image:border-cyan-500 peer-checked/image:bg-cyan-900/50">Gambar</label>
              <input type="radio" name="type" value="video" id="type-video" class="hidden peer/video">
              <label for="type-video" class="w-full block text-start px-3 py-2 border-2 border-transparent rounded-md text-sm cursor-pointer hover:bg-gray-700 peer-checked/video:border-cyan-500 peer-checked/video:bg-cyan-900/50">Video</label>
            </div>
          </div>

          <div class="pt-6 border-t border-gray-700">
            <label for="limit-input" class="font-semibold mb-2 block text-white">Konten per Halaman</label>
            <input type="number" name="limit" id="limit-input" value="25" min="10" max="200" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white">
          </div>

          <div class="pt-6 border-t border-gray-700">
            <h3 class="font-semibold text-white mb-3">Pengaturan Lain</h3>
            <div class="flex justify-between items-center text-sm mb-2">
              <label for="autoplay-toggle">Autoplay Video saat Hover</label>
              <label for="autoplay-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="autoplay-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
              </label>
            </div>
            <div class="flex justify-between items-center text-sm">
              <label for="lazyload-toggle">Lazy Loading Gambar</label>
              <label for="lazyload-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="lazyload-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
              </label>
            </div>
          </div>
        </div>

        <div class="mt-8">
          <button type="submit" class="w-full text-center bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-md">
            Terapkan Filter
          </button>
        </div>
      </form>
    </div>
  </aside>

  <header class="bg-gray-800/50 backdrop-blur-sm sticky top-0 z-30">
    <nav class="container mx-auto p-4 flex justify-between items-center">
      <a href="/search" class="text-2xl font-bold text-cyan-400 flex-shrink-0">CytusGallery</a>

      <div class="flex items-center gap-6">
        <div class="hidden md:flex items-center gap-6 text-gray-300">
          <a id="home-link" href="/search" class="hover:text-white transition-colors">Home</a>
          <a href="/tentang" class="hover:text-white transition-colors">Tentang</a>
          <a href="/bantuan" class="hover:text-white transition-colors">Bantuan</a>
        </div>

        <button id="open-sidebar-button" class="space-y-2 cursor-pointer">
          <span class="block w-8 h-0.5 bg-gray-100"></span>
          <span class="block w-8 h-0.5 bg-gray-100"></span>
          <span class="block w-8 h-0.5 bg-gray-100"></span>
        </button>
      </div>
    </nav>
  </header>
  <main class="flex-grow">
    <section class="container mx-auto px-4 py-2">
      <div class="relative">
        <form action="/search" method="GET" id="search-form">
          <div class="relative">
            <input type="text" name="tags" id="search-input" class="w-full bg-gray-700 border border-gray-600 rounded-md py-3 pl-4 pr-12 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="Cari berdasarkan tag..." autocomplete="off">
            <button type="submit" class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-cyan-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </form>
        <div id="suggestions-box" class="absolute z-40 w-full bg-gray-800 border border-gray-700 rounded-md mt-1 hidden">
        </div>
      </div>
    </section>
    <script></script>